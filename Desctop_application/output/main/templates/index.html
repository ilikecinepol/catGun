<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Bluetooth Gamepad</title>
    <style>
        body {
            text-align: center;
        }

        #gamepad-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #gamepad {
            width: 400px;
            height: 200px;
            background-color: #f0f0f0;
            border: 2px solid #000;
            position: relative;
            margin: 20px auto;
        }

        .direction-button {
            width: 40px;
            height: 40px;
            background-color: #0078d4;
            border: 2px solid #000;
            border-radius: 50%;
            position: absolute;
            cursor: pointer;
            text-align: center;
            line-height: 40px;
            font-weight: bold;
            font-size: 16px;
        }

        #button-up {
            top: 20px;
            left: 100px;
        }

        #button-down {
            bottom: 20px;
            left: 100px;
        }

        #button-left {
            top: 80px;
            left: 60px;
        }

        #button-right {
            top: 80px;
            left: 140px;
        }

        .function-button {
            width: 40px;
            height: 40px;
            background-color: #ff5733;
            border: 2px solid #000;
            border-radius: 50%;
            position: absolute;
            cursor: pointer;
            text-align: center;
            line-height: 40px;
            font-weight: bold;
            font-size: 16px;
        }

        #button-a {
            top: 80px;
            left: 320px;
            background-color: gray;
        }

        #button-b {
            top: 20px;
            left: 320px;
            background-color: gray;
        }

        #button-x {
            top: 20px;
            left: 240px;
            background-color: gray;
        }

        #button-y {
            top: 80px;
            left: 240px;
            background-color: gray;
        }

        #device-selector {
            width: 200px;
            margin: 20px auto;
        }
        /* –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ */
        .direction-button:active,
        .function-button:active {
        background-color: #ff5733; /* –ò–∑–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ */
        transform: scale(0.9); /* –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–Ω–æ–ø–∫–∏ */
}
    </style>
</head>
<body>
    <div id="gamepad-container">
        <div id="gamepad">
            <div id="button-up" class="direction-button" onclick="handleButtonClick('‚Üë')">‚Üë</div>
            <div id="button-down" class="direction-button" onclick="handleButtonClick('‚Üì')">‚Üì</div>
            <div id="button-left" class="direction-button" onclick="handleButtonClick('‚Üê')">‚Üê</div>
            <div id="button-right" class="direction-button" onclick="handleButtonClick('‚Üí')">‚Üí</div>
            <div id="button-a" class="function-button" onclick="handleButtonClick('A')">üê±</div>
            <div id="button-b" class="function-button" onclick="handleButtonClick('B')">üòΩ</div>
            <div id="button-x" class="function-button" onclick="handleButtonClick('X')">üôÄ</div>
            <div id="button-y" class="function-button" onclick="handleButtonClick('Y')">üòæ</div>

        </div>
        <select id="device-selector">
            {% for address, name in device_dict.items() %}
                <option value="{{ address }}">{{ name }}</option>
            {% endfor %}
        </select>
        <!-- –≠–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–º–µ–Ω–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ -->
        <p id="selected-device-name">Selected Device: None</p>
        <p id="connection-status">connection-status: None</p>
        <button id="connect-button" onchange="displaySelectedValue()">Connect</button>
        <p id="result">–í—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: </p>
        <!-- JavaScript-–∫–æ–¥ -->
        <script>
            function handleButtonClick(buttonName) {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                fetch('/button_click', {
                    method: 'POST',
                    body: 'button_name=' + buttonName,
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                }).then(response => {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–µ—Å–ª–∏ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ)
                }).catch(error => {
                    console.error('Error:', error);
                });
            }
            // –í–∞—à JavaScript-–∫–æ–¥ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            var deviceSelector = document.getElementById("device-selector");
            var deviceDict = {
                "device1": "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 1",
                "device2": "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 2",
                // –î—Ä—É–≥–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–∑ –≤–∞—à–µ–≥–æ —Å–ª–æ–≤–∞—Ä—è
            };

            for (var address in deviceDict) {
                if (deviceDict.hasOwnProperty(address)) {
                    var deviceName = deviceDict[address];
                    var option = document.createElement("option");
                    option.value = address;
                    option.text = deviceName;
                    deviceSelector.appendChild(option);
                }
            }
            document.getElementById('connect-button').addEventListener('click', async () => {
                const selectedDevice = document.getElementById('device-selector').value;

                // –û–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–º–µ–Ω–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                const selectedDeviceName = document.getElementById('selected-device-name');
                selectedDeviceName.textContent = `Selected Device: ${selectedDevice}`;

                const response = await fetch(`/connect?device=${selectedDevice}`);
                if (response.ok) {
                    document.getElementById('connection-status').textContent = 'Connected';

                    // –¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
                    const deviceInfoResponse = await fetch(`/device_info?device=${selectedDevice}`);
                    if (deviceInfoResponse.ok) {
                        document.getElementById('connection-status').textContent = 'Connection Success';
                    }
                } else {
                    document.getElementById('connection-status').textContent = 'Connection Failed';
                }
            });
            function displaySelectedValue() {
                // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤—ã–±–æ—Ä–∞
                var selectBox = document.getElementById("device-selector");

                // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                var selectedValue = selectBox.options[selectBox.selectedIndex].value;

                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                var resultElement = document.getElementById("result");
                resultElement.textContent = "–í—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: " + selectedValue;
            }

        </script>

    </div>

</body>
</html>
